<div class="container mt-4">
  <!-- Back Button -->
  <div class="row mb-3">
    <div class="col">
      <a routerLink="/products" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Products
      </a>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading product details...</p>
    </div>
  }

  <!-- Error State -->
  @if (error) {
    <div class="alert alert-danger" role="alert">
      {{ error }}
      <button class="btn btn-outline-danger btn-sm ms-3" (click)="loadProduct(product?._id || '')">
        Try Again
      </button>
    </div>
  }

  <!-- Product Details -->
  @if (!loading && !error && product) {
    <div class="row">
      <!-- Product Images -->
      <div class="col-md-6 mb-4">
        <div class="card">
          <img 
            [src]="selectedImage" 
            class="card-img-top" 
            [alt]="product.name"
            style="height: 400px; object-fit: contain;"
          >
          @if (product.images && product.images.length > 1) {
            <div class="card-footer bg-transparent">
              <div class="d-flex gap-2">
                @for (image of product.images; track image) {
                  <img 
                    [src]="image" 
                    (click)="selectedImage = image"
                    class="img-thumbnail" 
                    style="width: 60px; height: 60px; object-fit: cover; cursor: pointer;"
                    [class.border-primary]="selectedImage === image"
                  >
                }
              </div>
            </div>
          }
        </div>
      </div>

      <!-- Product Info -->
      <div class="col-md-6">
        <h1 class="display-6 mb-3">{{ product.name }}</h1>
        
        <div class="mb-3">
          <span class="badge" [class.bg-success]="product.inventory > 0" [class.bg-danger]="product.inventory === 0">
            {{ product.inventory > 0 ? 'In Stock' : 'Out of Stock' }}
          </span>
          @if (product.inventory > 0 && product.inventory <= 10) {
            <span class="badge bg-warning text-dark ms-2">
              Only {{ product.inventory }} left!
            </span>
          }
        </div>

        <div class="mb-4">
          <h2 class="text-primary">${{ product.price.toFixed(2) }}</h2>
        </div>

        <div class="mb-4">
          <h5>Description</h5>
          <p class="text-muted">{{ product.description }}</p>
        </div>

        <div class="mb-4">
          <div class="row g-3">
            <div class="col-sm-6">
              <div class="bg-light p-3 rounded">
                <small class="text-muted d-block">SKU</small>
                <strong>{{ product.sku }}</strong>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="bg-light p-3 rounded">
                <small class="text-muted d-block">Category</small>
                <strong>{{ product.category }}</strong>
              </div>
            </div>
          </div>
        </div>

        <div class="mb-4">
          <div class="d-grid gap-2 d-md-flex">
            <button 
              class="btn btn-primary btn-lg flex-grow-1" 
              (click)="addToCart()"
              [disabled]="product.inventory === 0"
            >
              <i class="bi bi-cart-plus"></i> Add to Cart
            </button>
            <button 
              class="btn btn-success btn-lg flex-grow-1" 
              (click)="buyNow()"
              [disabled]="product.inventory === 0"
            >
              <i class="bi bi-lightning-charge"></i> Buy Now
            </button>
          </div>
        </div>

        <!-- Additional Info -->
        <div class="accordion" id="productAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#shipping">
                Shipping Information
              </button>
            </h2>
            <div id="shipping" class="accordion-collapse collapse" data-bs-parent="#productAccordion">
              <div class="accordion-body">
                <p class="mb-0">Free shipping on orders over $50. Estimated delivery: 3-5 business days.</p>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#returns">
                Returns & Warranty
              </button>
            </h2>
            <div id="returns" class="accordion-collapse collapse" data-bs-parent="#productAccordion">
              <div class="accordion-body">
                <p class="mb-0">30-day return policy. 1-year manufacturer warranty.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>